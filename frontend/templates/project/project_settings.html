{% extends "base_app.html" %}
{% load static %}
{% load widget_tweaks %}

{% block content %}
<div class="py-8 bg-white sm:py-12">
  <div class="px-4 mx-auto max-w-7xl sm:px-6 lg:px-8">

    <!-- Project Header -->
    <div class="mb-8">
      <div class="flex flex-col gap-4 items-center sm:flex-row sm:justify-between">
        <!-- Back to Projects Button - Hidden on mobile, visible on desktop -->
        <div class="hidden sm:block sm:flex-shrink-0">
          <a
            href="{% url 'home' %}"
            class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white rounded-md border border-gray-300 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500"
          >
            <svg class="mr-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
            Back to Projects
          </a>
        </div>

        <!-- Project Title - Centered -->
        <div class="flex-1 text-center">
          <h1 class="text-2xl font-bold text-gray-900 sm:text-3xl">
            {{ project.name }}
          </h1>
          <div class="flex justify-center items-center mt-2">
            <span class="inline-flex items-center px-2.5 py-0.5 text-xs font-medium text-gray-700 bg-gray-100 rounded-full border">
              {{ project.get_type_display }}
            </span>
            {% if project.url %}
              <a href="{{ project.url }}" target="_blank" rel="noopener noreferrer"
                 class="inline-flex items-center ml-3 text-sm text-gray-600 hover:text-gray-900">
                <svg class="mr-1 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                </svg>
                Visit Site
              </a>
            {% endif %}
          </div>
        </div>

        <!-- Spacer for desktop alignment -->
        <div class="hidden sm:block sm:flex-shrink-0 sm:w-[140px]"></div>

        <!-- Back to Projects Button for Mobile - Full width below title -->
        <div class="block w-full sm:hidden">
          <a
            href="{% url 'home' %}"
            class="inline-flex justify-center items-center px-4 py-2 w-full text-sm font-medium text-gray-700 bg-white rounded-md border border-gray-300 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500"
          >
            <svg class="mr-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
            Back to Projects
          </a>
        </div>
      </div>
    </div>

    <!-- Main Layout: Sidebar Navigation + Content + TOC -->
    <div class="flex flex-col gap-6 lg:flex-row lg:items-start" data-controller="toc">

      <!-- Sidebar Navigation -->
      <aside class="space-y-6 w-full lg:w-64 lg:flex-shrink-0 lg:sticky lg:top-6" style="align-self: flex-start;">
        {% include "components/project_navigation.html" %}

        <!-- Table of Contents (Desktop) -->
        <div class="hidden lg:block">
          <nav class="bg-white rounded-lg border border-gray-200 shadow-sm" data-toc-target="sidebar">
            <div class="p-4">
              <h2 class="px-3 mb-2 text-xs font-semibold tracking-wider text-gray-500 uppercase">
                On This Page
              </h2>
              <ul class="space-y-2" data-toc-target="list">
                <!-- TOC items will be generated here -->
              </ul>
            </div>
          </nav>
        </div>
      </aside>

      <!-- Main Content Area -->
      <main class="relative flex-1 w-full pointer-events-auto lg:min-w-0" data-toc-target="content">
        <!-- Page Header -->
        <div class="mb-8">
          <h1 class="text-3xl font-bold tracking-tight text-gray-900">Settings</h1>
          <p class="mt-2 text-base text-gray-600">Manage your project configuration and automation settings</p>
        </div>

<!-- Settings Grid -->
<div class="space-y-8">

  <!-- Project Details Section -->
  <section id="project-details" class="bg-white rounded-lg border border-gray-200 shadow-sm">
    <div class="px-6 py-5 border-b border-gray-200">
      <h2 class="text-xl font-semibold text-gray-900">Project Details</h2>
      <p class="mt-1 text-sm text-gray-500">Information about your project that helps generate better content</p>
    </div>

    <div class="px-6 py-6">
      <!-- Info Banner -->
      <div class="p-4 mb-6 bg-blue-50 rounded-lg border border-blue-200">
        <div class="flex gap-3">
          <div class="flex-shrink-0">
            <svg class="w-5 h-5 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <div>
            <h3 class="text-sm font-medium text-blue-900">Pre-filled Information</h3>
            <p class="mt-1 text-sm text-blue-700">
              We've analyzed your website and pre-filled these details. Review and update them to improve content quality.
            </p>
          </div>
        </div>
      </div>

      <form
        data-controller="project-details"
        data-project-details-project-id-value="{{ project.id }}"
        data-action="project-details#save"
      >
        {% csrf_token %}

        <div class="space-y-8">
          <!-- Basic Information -->
          <div id="basic-information">
            <h3 class="mb-4 text-base font-semibold text-gray-900">Basic Information</h3>
            <div class="space-y-6">
              <div>
                <label for="summary" class="block mb-2 text-sm font-medium text-gray-700">
                  Project Summary
                </label>
                <p class="mb-2 text-xs text-gray-500">A brief description of what your project does</p>
                <textarea
                  id="summary"
                  name="summary"
                  data-project-details-target="input"
                  class="block w-full rounded-lg border-gray-300 shadow-sm transition-colors focus:border-gray-500 focus:ring-gray-500 sm:text-sm"
                  rows="4"
                  placeholder="e.g., A platform that helps developers build faster..."
                >{{ project.summary }}</textarea>
              </div>

              <div>
                <label for="key_features" class="block mb-2 text-sm font-medium text-gray-700">
                  Key Features
                </label>
                <p class="mb-2 text-xs text-gray-500">Main functionalities and what makes your project unique</p>
                <textarea
                  id="key_features"
                  name="key_features"
                  data-project-details-target="input"
                  class="block w-full rounded-lg border-gray-300 shadow-sm transition-colors focus:border-gray-500 focus:ring-gray-500 sm:text-sm"
                  rows="4"
                  placeholder="e.g., Real-time collaboration, AI-powered suggestions..."
                >{{ project.key_features }}</textarea>
              </div>
            </div>
          </div>

          <!-- Audience & Usage -->
          <div id="audience-usage" class="pt-8 border-t border-gray-200">
            <h3 class="mb-4 text-base font-semibold text-gray-900">Audience & Usage</h3>
            <div class="space-y-6">
              <div>
                <label for="target_audience" class="block mb-2 text-sm font-medium text-gray-700">
                  Target Audience
                </label>
                <p class="mb-2 text-xs text-gray-500">Who is this product for?</p>
                <textarea
                  id="target_audience"
                  name="target_audience_summary"
                  data-project-details-target="input"
                  class="block w-full rounded-lg border-gray-300 shadow-sm transition-colors focus:border-gray-500 focus:ring-gray-500 sm:text-sm"
                  rows="3"
                  placeholder="e.g., Software developers, startup founders, product managers..."
                >{{ project.target_audience_summary }}</textarea>
              </div>

              <div>
                <label for="pain_points" class="block mb-2 text-sm font-medium text-gray-700">
                  Problems Solved
                </label>
                <p class="mb-2 text-xs text-gray-500">What pain points does your product address?</p>
                <textarea
                  id="pain_points"
                  name="pain_points"
                  data-project-details-target="input"
                  class="block w-full rounded-lg border-gray-300 shadow-sm transition-colors focus:border-gray-500 focus:ring-gray-500 sm:text-sm"
                  rows="4"
                  placeholder="e.g., Reduces development time, eliminates manual processes..."
                >{{ project.pain_points }}</textarea>
              </div>

              <div>
                <label for="product_usage" class="block mb-2 text-sm font-medium text-gray-700">
                  How It's Used
                </label>
                <p class="mb-2 text-xs text-gray-500">Describe typical usage scenarios</p>
                <textarea
                  id="product_usage"
                  name="product_usage"
                  data-project-details-target="input"
                  class="block w-full rounded-lg border-gray-300 shadow-sm transition-colors focus:border-gray-500 focus:ring-gray-500 sm:text-sm"
                  rows="4"
                  placeholder="e.g., Teams use it daily for project planning and execution..."
                >{{ project.product_usage }}</textarea>
              </div>
            </div>
          </div>

          <!-- Additional Settings -->
          <div id="additional-settings" class="pt-8 border-t border-gray-200">
            <h3 class="mb-4 text-base font-semibold text-gray-900">Additional Settings</h3>
            <div class="space-y-6">
              <div>
                <label for="blog_theme" class="block mb-2 text-sm font-medium text-gray-700">
                  Blog Content Theme
                </label>
                <p class="mb-2 text-xs text-gray-500">Overall direction and focus for your blog content</p>
                <textarea
                  id="blog_theme"
                  name="blog_theme"
                  data-project-details-target="input"
                  class="block w-full rounded-lg border-gray-300 shadow-sm transition-colors focus:border-gray-500 focus:ring-gray-500 sm:text-sm"
                  rows="3"
                  placeholder="e.g., Technical tutorials, industry insights, product updates..."
                >{{ project.blog_theme }}</textarea>
              </div>

              <div>
                <label for="links" class="block mb-2 text-sm font-medium text-gray-700">
                  Related Links
                </label>
                <p class="mb-2 text-xs text-gray-500">Documentation, social media, or other relevant resources</p>
                <textarea
                  id="links"
                  name="links"
                  data-project-details-target="input"
                  class="block w-full rounded-lg border-gray-300 shadow-sm transition-colors focus:border-gray-500 focus:ring-gray-500 sm:text-sm"
                  rows="3"
                  placeholder="Add relevant links (one per line)..."
                >{{ project.links }}</textarea>
              </div>

              <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                <div>
                  <label for="founders" class="block mb-2 text-sm font-medium text-gray-700">
                    Team / Founders
                  </label>
                  <p class="mb-2 text-xs text-gray-500">Key team members to mention in content</p>
                  <textarea
                    id="founders"
                    name="founders"
                    data-project-details-target="input"
                    class="block w-full rounded-lg border-gray-300 shadow-sm transition-colors focus:border-gray-500 focus:ring-gray-500 sm:text-sm"
                    rows="2"
                    placeholder="e.g., John Doe, Jane Smith..."
                  >{{ project.founders }}</textarea>
                </div>

                <div>
                  <label for="language" class="block mb-2 text-sm font-medium text-gray-700">
                    Content Language
                  </label>
                  <p class="mb-2 text-xs text-gray-500">Primary language for generated content</p>
                  <select
                    id="language"
                    name="language"
                    data-project-details-target="input"
                    class="block w-full rounded-lg border-gray-300 shadow-sm transition-colors focus:border-gray-500 focus:ring-gray-500 sm:text-sm"
                  >
                    {% for value, label in languages %}
                      <option value="{{ value }}" {% if project.language == value %}selected{% endif %}>{{ label }}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Save Button -->
        <div class="flex justify-end pt-6 mt-8 border-t border-gray-200">
          <button
            type="submit"
            class="inline-flex items-center px-6 py-2.5 text-sm font-semibold text-white bg-gray-800 rounded-lg shadow-sm transition-all hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2"
          >
            <svg class="mr-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            Save Project Details
          </button>
        </div>
      </form>
    </div>
  </section>

  <!-- OG Image Generation Section -->
  <section id="og-image-generation" class="bg-white rounded-lg border border-gray-200 shadow-sm {% if not has_pro_subscription %}opacity-75{% endif %}">
    <div class="px-6 py-5 border-b border-gray-200">
      <div class="flex justify-between items-start">
        <div>
          <h2 class="text-xl font-semibold text-gray-900">OG Image Generation</h2>
          <p class="mt-1 text-sm text-gray-500">Automatically generate Open Graph images for your blog posts</p>
        </div>
        <!-- Toggle Switch -->
        <div
          data-controller="og-image-toggle"
          data-og-image-toggle-project-id-value="{{ project.id }}"
          data-og-image-toggle-enabled-value="{{ project.enable_automatic_og_image_generation|lower }}"
        >
          <button
            type="button"
            data-action="og-image-toggle#toggle"
            data-og-image-toggle-target="toggle"
            class="group relative inline-flex w-11 shrink-0 rounded-full bg-gray-200 p-0.5 outline-offset-2 outline-gray-600 ring-1 ring-inset ring-gray-900/5 transition-colors duration-200 ease-in-out has-[:checked]:bg-gray-600 has-[:focus-visible]:outline has-[:focus-visible]:outline-2 {% if not has_pro_subscription %}cursor-not-allowed opacity-50{% endif %}"
            role="switch"
            aria-checked="{{ project.enable_automatic_og_image_generation|lower }}"
            {% if not has_pro_subscription %}disabled{% endif %}
          >
            <span
              data-og-image-toggle-target="switch"
              class="size-5 rounded-full bg-white shadow-sm ring-1 ring-gray-900/5 transition-transform duration-200 ease-in-out group-has-[:checked]:translate-x-5"
            ></span>
          </button>
        </div>
      </div>
    </div>

    <div class="px-6 py-6">
      {% if not has_pro_subscription %}
        <!-- Upgrade Banner for Free Users -->
        <div class="p-4 mb-6 bg-amber-50 rounded-lg border border-amber-200">
          <div class="flex gap-3">
            <div class="flex-shrink-0">
              <svg class="w-5 h-5 text-amber-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
              </svg>
            </div>
            <div class="flex-1">
              <h3 class="text-sm font-medium text-amber-900">Pro Feature</h3>
              <p class="mt-1 text-sm text-amber-700">
                Automatic OG Image Generation is available on the Pro plan. Upgrade to automatically create eye-catching social media images for all your blog posts.
              </p>
              <div class="mt-3">
                <a
                  href="{% url 'settings' %}"
                  class="inline-flex items-center px-4 py-2 text-sm font-semibold text-amber-900 bg-amber-100 rounded-lg border border-amber-300 transition-colors hover:bg-amber-200"
                >
                  <svg class="mr-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                  </svg>
                  Upgrade to Pro
                </a>
              </div>
            </div>
          </div>
        </div>
      {% endif %}

      <form
        data-controller="project-details"
        data-project-details-project-id-value="{{ project.id }}"
        data-action="project-details#save"
      >
        {% csrf_token %}

        <div class="space-y-6">
          {% if has_pro_subscription %}
          <!-- Info Banner -->
          <div class="p-4 bg-blue-50 rounded-lg border border-blue-200">
            <div class="flex gap-3">
              <div class="flex-shrink-0">
                <svg class="w-5 h-5 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </div>
              <div>
                <h3 class="text-sm font-medium text-blue-900">About OG Images</h3>
                <p class="mt-1 text-sm text-blue-700">
                  Open Graph images appear when your blog posts are shared on social media platforms like Facebook, Twitter, and LinkedIn. We'll automatically generate eye-catching images based on your post titles and selected style.
                </p>
              </div>
            </div>
          </div>
          {% endif %}

          <!-- Image Style Selection -->
          <div id="og-image-style">
            <h3 class="mb-4 text-base font-semibold text-gray-900">Image Style</h3>
            <div>
              <label for="og_image_style" class="block mb-2 text-sm font-medium {% if not has_pro_subscription %}text-gray-400{% else %}text-gray-700{% endif %}">
                Visual Style for Generated Images
              </label>
              <p class="mb-2 text-xs {% if not has_pro_subscription %}text-gray-400{% else %}text-gray-500{% endif %}">Choose the aesthetic that best matches your brand</p>
              <select
                id="og_image_style"
                name="og_image_style"
                data-project-details-target="input"
                class="block w-full rounded-lg border-gray-300 shadow-sm transition-colors focus:border-gray-500 focus:ring-gray-500 sm:text-sm {% if not has_pro_subscription %}cursor-not-allowed opacity-50{% endif %}"
                {% if not has_pro_subscription %}disabled{% endif %}
              >
                {% for value, label in og_image_styles %}
                  <option value="{{ value }}" {% if project.og_image_style == value %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
              </select>
            </div>

            <!-- Style Descriptions -->
            <div class="p-4 mt-4 {% if not has_pro_subscription %}bg-gray-100{% else %}bg-gray-50{% endif %} rounded-lg">
              <h4 class="mb-3 text-sm font-medium {% if not has_pro_subscription %}text-gray-400{% else %}text-gray-900{% endif %}">Style Descriptions</h4>
              <div class="space-y-2 text-xs {% if not has_pro_subscription %}text-gray-400{% else %}text-gray-600{% endif %}">
                <p><strong>Modern Gradient:</strong> Contemporary gradient backgrounds with clean typography</p>
                <p><strong>Minimalist Clean:</strong> Simple, elegant designs with plenty of white space</p>
                <p><strong>Bold Typography:</strong> Eye-catching text-focused designs with strong contrast</p>
                <p><strong>Tech Abstract:</strong> Geometric patterns and tech-inspired visuals</p>
                <p><strong>Professional Corporate:</strong> Business-friendly, polished appearance</p>
                <p><strong>Creative Artistic:</strong> Artistic flair with unique visual elements</p>
                <p><strong>Dark Mode:</strong> Dark backgrounds with vibrant accent colors</p>
                <p><strong>Vibrant Colorful:</strong> Bold colors and energetic compositions</p>
              </div>
            </div>
          </div>
        </div>

        {% if has_pro_subscription %}
        <!-- Save Button -->
        <div class="flex justify-end pt-6 mt-6 border-t border-gray-200">
          <button
            type="submit"
            class="inline-flex items-center px-6 py-2.5 text-sm font-semibold text-white bg-gray-800 rounded-lg shadow-sm transition-all hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2"
          >
            <svg class="mr-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            Save OG Image Settings
          </button>
        </div>
        {% endif %}
      </form>
    </div>
  </section>

  <!-- Automatic Submission Section -->
  <section id="automatic-submission" class="bg-white rounded-lg border border-gray-200 shadow-sm {% if not has_pro_subscription %}opacity-75{% endif %}">
    <div class="px-6 py-5 border-b border-gray-200">
      <div class="flex justify-between items-start">
        <div>
          <h2 class="text-xl font-semibold text-gray-900">Automatic Post Submission</h2>
          <p class="mt-1 text-sm text-gray-500">Automatically publish generated blog posts to your website</p>
        </div>
        <!-- Toggle Switch -->
        <div
          data-controller="auto-submission-toggle"
          data-auto-submission-toggle-project-id-value="{{ project.id }}"
          data-auto-submission-toggle-enabled-value="{{ project.enable_automatic_post_submission|lower }}"
        >
          <button
            type="button"
            data-action="auto-submission-toggle#toggle"
            data-auto-submission-toggle-target="toggle"
            class="group relative inline-flex w-11 shrink-0 rounded-full bg-gray-200 p-0.5 outline-offset-2 outline-gray-600 ring-1 ring-inset ring-gray-900/5 transition-colors duration-200 ease-in-out has-[:checked]:bg-gray-600 has-[:focus-visible]:outline has-[:focus-visible]:outline-2 {% if not has_pro_subscription %}cursor-not-allowed opacity-50{% endif %}"
            role="switch"
            aria-checked="{{ project.enable_automatic_post_submission|lower }}"
            {% if not has_pro_subscription %}disabled{% endif %}
          >
            <span
              data-auto-submission-toggle-target="switch"
              class="size-5 rounded-full bg-white shadow-sm ring-1 ring-gray-900/5 transition-transform duration-200 ease-in-out group-has-[:checked]:translate-x-5"
            ></span>
          </button>
        </div>
      </div>
    </div>

    <div class="px-6 py-6">
      {% if not has_pro_subscription %}
        <!-- Upgrade Banner for Free Users -->
        <div class="p-4 mb-6 bg-amber-50 rounded-lg border border-amber-200">
          <div class="flex gap-3">
            <div class="flex-shrink-0">
              <svg class="w-5 h-5 text-amber-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
              </svg>
            </div>
            <div class="flex-1">
              <h3 class="text-sm font-medium text-amber-900">Pro Feature</h3>
              <p class="mt-1 text-sm text-amber-700">
                Automatic Post Submission is available on the Pro plan. Upgrade to automatically publish your generated blog posts to your website via API.
              </p>
              <div class="mt-3">
                <a
                  href="{% url 'settings' %}"
                  class="inline-flex items-center px-4 py-2 text-sm font-semibold text-amber-900 bg-amber-100 rounded-lg border border-amber-300 transition-colors hover:bg-amber-200"
                >
                  <svg class="mr-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                  </svg>
                  Upgrade to Pro
                </a>
              </div>
            </div>
          </div>
        </div>
      {% endif %}

      <form method="post" class="space-y-8">
        {% csrf_token %}
        {{ auto_submission_settings_form.non_field_errors | safe }}

        <!-- Datalist for dynamic value suggestions -->
        <datalist id="body-value-suggestions">
          <option value="{% templatetag openvariable %} title {% templatetag closevariable %}"></option>
          <option value="{% templatetag openvariable %} description {% templatetag closevariable %}"></option>
          <option value="{% templatetag openvariable %} slug {% templatetag closevariable %}"></option>
          <option value="{% templatetag openvariable %} tags {% templatetag closevariable %}"></option>
          <option value="{% templatetag openvariable %} content {% templatetag closevariable %}"></option>
          <option value="{% templatetag openvariable %} created_at {% templatetag closevariable %}"></option>
        </datalist>

        <!-- API Configuration -->
        <div id="api-configuration">
          <h3 class="mb-4 text-base font-semibold {% if not has_pro_subscription %}text-gray-400{% else %}text-gray-900{% endif %}">API Configuration</h3>
          <div class="space-y-6">
            {% for field in auto_submission_settings_form.visible_fields %}
              {% if field.name != "body" and field.name != "header" and field.name != "posts_per_month" %}
                <div>
                  {{ field.errors | safe }}
                  <label for="{{ field.id_for_label }}" class="block mb-2 text-sm font-medium {% if not has_pro_subscription %}text-gray-400{% else %}text-gray-700{% endif %}">
                    {{ field.label }}
                  </label>
                  {% if field.help_text %}
                    <p class="mb-2 text-xs {% if not has_pro_subscription %}text-gray-400{% else %}text-gray-500{% endif %}">{{ field.help_text }}</p>
                  {% endif %}
                  {% if not has_pro_subscription %}
                    {% render_field field class="block px-3 py-2 w-full placeholder-gray-500 text-gray-900 rounded-lg border border-gray-300 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-gray-500 sm:text-sm" disabled="disabled" %}
                  {% else %}
                    {% render_field field class="block px-3 py-2 w-full placeholder-gray-500 text-gray-900 rounded-lg border border-gray-300 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-gray-500 sm:text-sm" %}
                  {% endif %}
                </div>
              {% endif %}
            {% endfor %}
          </div>
        </div>

        <!-- Request Headers -->
        <div id="request-headers" class="pt-8 border-t border-gray-200">
          <h3 class="mb-4 text-base font-semibold {% if not has_pro_subscription %}text-gray-400{% else %}text-gray-900{% endif %}">Request Headers</h3>
          <p class="mb-4 text-sm {% if not has_pro_subscription %}text-gray-400{% else %}text-gray-500{% endif %}">Add custom headers for your API requests (e.g., authentication tokens)</p>
          {% for field in auto_submission_settings_form.visible_fields %}
            {% if field.name == "header" %}
              <div
                data-controller="auto-submit-header"
                data-auto-submit-header-initial-value="{{ field.value|default:'{}' }}"
              >
                <div data-auto-submit-header-target="rows" class="space-y-3"></div>
                <button
                  type="button"
                  data-action="auto-submit-header#addRow"
                  class="inline-flex items-center px-4 py-2 mt-3 text-sm font-medium {% if not has_pro_subscription %}text-gray-400 cursor-not-allowed{% else %}text-gray-700 hover:bg-gray-50{% endif %} bg-white rounded-lg border border-gray-300 transition-colors"
                  {% if not has_pro_subscription %}disabled{% endif %}
                >
                  <svg class="mr-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                  </svg>
                  Add Header
                </button>
                <input type="hidden" name="header" data-auto-submit-header-target="jsonInput">
              </div>
            {% endif %}
          {% endfor %}
        </div>

        <!-- Request Body -->
        <div id="request-body" class="pt-8 border-t border-gray-200">
          <h3 class="mb-4 text-base font-semibold {% if not has_pro_subscription %}text-gray-400{% else %}text-gray-900{% endif %}">Request Body</h3>
          {% if has_pro_subscription %}
          <div class="p-4 mb-4 bg-amber-50 rounded-lg border border-amber-200">
            <div class="flex gap-3">
              <svg class="flex-shrink-0 w-5 h-5 text-amber-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <div class="text-sm text-amber-800">
                <p class="font-medium">Dynamic Values</p>
                <p class="mt-1">
                  Use
                  <code class="px-1 py-0.5 bg-amber-100 rounded">{% templatetag openvariable %} variable_name {% templatetag closevariable %}</code>
                  for dynamic content. Available:
                  <code class="px-1 py-0.5 bg-amber-100 rounded">title</code>,
                  <code class="px-1 py-0.5 bg-amber-100 rounded">description</code>,
                  <code class="px-1 py-0.5 bg-amber-100 rounded">slug</code>,
                  <code class="px-1 py-0.5 bg-amber-100 rounded">tags</code>,
                  <code class="px-1 py-0.5 bg-amber-100 rounded">content</code>,
                  <code class="px-1 py-0.5 bg-amber-100 rounded">created_at</code>
                </p>
              </div>
            </div>
          </div>
          {% endif %}
          {% for field in auto_submission_settings_form.visible_fields %}
            {% if field.name == "body" %}
              <div
                data-controller="auto-submit-body"
                data-auto-submit-body-initial-value="{{ field.value|default:'{}' }}"
              >
                <div data-auto-submit-body-target="rows" class="space-y-3"></div>
                <button
                  type="button"
                  data-action="auto-submit-body#addRow"
                  class="inline-flex items-center px-4 py-2 mt-3 text-sm font-medium {% if not has_pro_subscription %}text-gray-400 cursor-not-allowed{% else %}text-gray-700 hover:bg-gray-50{% endif %} bg-white rounded-lg border border-gray-300 transition-colors"
                  {% if not has_pro_subscription %}disabled{% endif %}
                >
                  <svg class="mr-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                  </svg>
                  Add Field
                </button>
                <input type="hidden" name="body" data-auto-submit-body-target="jsonInput">
              </div>
            {% endif %}
          {% endfor %}
        </div>

        <!-- Publishing Schedule -->
        <div id="publishing-schedule" class="pt-8 border-t border-gray-200">
          <h3 class="mb-4 text-base font-semibold {% if not has_pro_subscription %}text-gray-400{% else %}text-gray-900{% endif %}">Publishing Schedule</h3>
          <div class="space-y-6">
            {% for field in auto_submission_settings_form.visible_fields %}
              {% if field.name == "posts_per_month" %}
                <div>
                  {{ field.errors | safe }}
                  <label for="{{ field.id_for_label }}" class="block mb-2 text-sm font-medium {% if not has_pro_subscription %}text-gray-400{% else %}text-gray-700{% endif %}">
                    {{ field.label }}
                  </label>
                  {% if field.help_text %}
                    <p class="mb-2 text-xs {% if not has_pro_subscription %}text-gray-400{% else %}text-gray-500{% endif %}">{{ field.help_text }}</p>
                  {% endif %}
                  {% if not has_pro_subscription %}
                    {% render_field field class="block px-3 py-2 w-full placeholder-gray-500 text-gray-900 rounded-lg border border-gray-300 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-gray-500 sm:text-sm" disabled="disabled" %}
                  {% else %}
                    {% render_field field class="block px-3 py-2 w-full placeholder-gray-500 text-gray-900 rounded-lg border border-gray-300 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-gray-500 sm:text-sm" %}
                  {% endif %}
                </div>
              {% endif %}
            {% endfor %}
          </div>
        </div>

        {% if has_pro_subscription %}
        <!-- Form Actions -->
        <div class="flex justify-between items-center pt-6 border-t border-gray-200">
          <a
            href="{% url 'publish_history' project.id %}"
            class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white rounded-lg border border-gray-300 transition-colors hover:bg-gray-50"
          >
            <svg class="mr-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            View Publish History
          </a>

          <button
            type="submit"
            class="inline-flex items-center px-6 py-2.5 text-sm font-semibold text-white bg-gray-800 rounded-lg shadow-sm transition-all hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2"
          >
            <svg class="mr-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            Save Submission Settings
          </button>
        </div>
        {% endif %}
      </form>
    </div>
  </section>

  <!-- Link Exchange Section -->
  <section id="link-exchange" class="bg-white rounded-lg border border-gray-200 shadow-sm {% if not has_pro_subscription %}opacity-75{% endif %}">
    <div class="px-6 py-5 border-b border-gray-200">
      <div class="flex justify-between items-start">
        <div>
          <h2 class="text-xl font-semibold text-gray-900">
            Link Exchange Program
          </h2>
          <p class="mt-1 text-sm text-gray-500">Participate in cross-linking with other projects to improve SEO</p>
        </div>
        <!-- Toggle Switch -->
        <div
          data-controller="link-exchange-toggle"
          data-link-exchange-toggle-project-id-value="{{ project.id }}"
          data-link-exchange-toggle-enabled-value="{{ project.particiate_in_link_exchange|lower }}"
        >
          <button
            type="button"
            data-action="link-exchange-toggle#toggle"
            data-link-exchange-toggle-target="toggle"
            class="group relative inline-flex w-11 shrink-0 rounded-full bg-gray-200 p-0.5 outline-offset-2 outline-gray-600 ring-1 ring-inset ring-gray-900/5 transition-colors duration-200 ease-in-out has-[:checked]:bg-gray-600 has-[:focus-visible]:outline has-[:focus-visible]:outline-2 {% if not has_pro_subscription %}cursor-not-allowed opacity-50{% endif %}"
            role="switch"
            aria-checked="{{ project.particiate_in_link_exchange|lower }}"
            {% if not has_pro_subscription %}disabled{% endif %}
          >
            <span
              data-link-exchange-toggle-target="switch"
              class="size-5 rounded-full bg-white shadow-sm ring-1 ring-gray-900/5 transition-transform duration-200 ease-in-out group-has-[:checked]:translate-x-5"
            ></span>
          </button>
        </div>
      </div>
    </div>

    <div class="px-6 py-6">
      {% if not has_pro_subscription %}
        <!-- Upgrade Banner for Free Users -->
        <div class="p-4 mb-6 bg-amber-50 rounded-lg border border-amber-200">
          <div class="flex gap-3">
            <div class="flex-shrink-0">
              <svg class="w-5 h-5 text-amber-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
              </svg>
            </div>
            <div class="flex-1">
              <h3 class="text-sm font-medium text-amber-900">Pro Feature</h3>
              <p class="mt-1 text-sm text-amber-700">
                Link Exchange is available on the Pro plan. Upgrade to participate in our link exchange program and boost your SEO with natural backlinks.
              </p>
              <div class="mt-3">
                <a
                  href="{% url 'settings' %}"
                  class="inline-flex items-center px-4 py-2 text-sm font-semibold text-amber-900 bg-amber-100 rounded-lg border border-amber-300 transition-colors hover:bg-amber-200"
                >
                  <svg class="mr-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                  </svg>
                  Upgrade to Pro
                </a>
              </div>
            </div>
          </div>
        </div>
      {% else %}
        <!-- Info Banner -->
        <div class="p-4 mb-6 bg-blue-50 rounded-lg border border-blue-200">
          <div class="flex gap-3">
            <div class="flex-shrink-0">
              <svg class="w-5 h-5 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            <div>
              <h3 class="text-sm font-medium text-blue-900">About Link Exchange</h3>
              <p class="mt-1 text-sm text-blue-700">
                When enabled, TuxSEO will automatically insert relevant links from other participating projects into your blog posts, and vice versa. This helps improve SEO through natural backlinks and provides additional value to readers.
              </p>
            </div>
          </div>
        </div>
      {% endif %}

      <!-- Feature Details -->
      <div class="mt-6 space-y-4">
        <div>
          <h3 class="mb-3 text-base font-semibold text-gray-900">How It Works</h3>
          <ul class="space-y-2 text-sm {% if not has_pro_subscription %}text-gray-400{% else %}text-gray-600{% endif %}">
            <li class="flex gap-2 items-start">
              <svg class="flex-shrink-0 mt-0.5 w-5 h-5 {% if not has_pro_subscription %}text-gray-400{% else %}text-green-600{% endif %}" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              <span>Links are inserted organically into relevant sections of your blog posts</span>
            </li>
            <li class="flex gap-2 items-start">
              <svg class="flex-shrink-0 mt-0.5 w-5 h-5 {% if not has_pro_subscription %}text-gray-400{% else %}text-green-600{% endif %}" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              <span>AI matches content contextually to ensure links add value</span>
            </li>
            <li class="flex gap-2 items-start">
              <svg class="flex-shrink-0 mt-0.5 w-5 h-5 {% if not has_pro_subscription %}text-gray-400{% else %}text-green-600{% endif %}" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              <span>You maintain full control and can disable at any time</span>
            </li>
            <li class="flex gap-2 items-start">
              <svg class="flex-shrink-0 mt-0.5 w-5 h-5 {% if not has_pro_subscription %}text-gray-400{% else %}text-green-600{% endif %}" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              <span>Limited to a small number of external links per post to maintain quality</span>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </section>

</div>
      </main>

    </div>
  </div>
</div>
{% endblock content %}
