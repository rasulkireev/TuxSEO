{% extends "base.html" %}
{% load static %}
{% load widget_tweaks %}

{% block content %}
<div class="px-6 py-12 mx-auto max-w-7xl sm:py-16">
  <div class="mx-auto max-w-4xl">
    <!-- Page Header -->
    <div class="mb-8">
      <h1 class="text-2xl font-bold tracking-tight text-gray-900">Project Settings</h1>
      <p class="mt-2 text-sm text-gray-600">Configure your project details and automation preferences.</p>
    </div>
    <!-- Project Details Section -->
    <div class="bg-white rounded-md border border-gray-200 shadow-sm" id="project-details">
      <div data-controller="archived-list" class="archived-list" data-archived-list-name-value="project-details">
        <button
          class="flex justify-between items-center px-6 py-4 w-full text-left rounded-t-md transition-colors hover:bg-gray-100 focus:outline-none"
          data-action="click->archived-list#toggle"
        >
          <div>
            <h2 class="text-xl font-bold tracking-tight text-gray-900">Project Details</h2>
            <p class="mt-1 text-sm text-gray-600">Configure your project settings and preferences</p>
          </div>
          <svg class="w-5 h-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </button>
        <div data-archived-list-target="list" class="p-6 border-t border-gray-200">
      <div class="p-4 mb-6 bg-gray-50 rounded-md border border-gray-200">
        <div class="flex gap-3">
          <div class="flex-shrink-0">
            <div class="flex justify-center items-center w-8 h-8 bg-gray-100 rounded-full">
              <svg class="w-4 h-4 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
          </div>
          <div>
            <h4 class="text-sm font-semibold text-gray-900">Pre-filled Project Details</h4>
            <p class="mt-1 text-sm text-gray-600">
              We've pre-filled these details based on our analysis of your website. Review and update as needed for better content quality.
            </p>
          </div>
        </div>
      </div>
      <form
        data-controller="project-details"
        data-project-details-project-id-value="{{ project.id }}"
        data-action="project-details#save"
      >
        {% csrf_token %}
        <div class="space-y-6">
          <!-- Project Overview Section -->
          <div class="space-y-4">
            <h3 class="text-lg font-semibold text-gray-900">Project Overview</h3>
            <div class="grid gap-4">
              <div>
                <div class="space-y-2">
                  <label for="summary" class="block text-sm font-medium text-gray-700">
                    Summary
                    <span class="ml-1 text-xs text-gray-500">(Brief description of your project)</span>
                  </label>
                  <textarea
                    id="summary"
                    name="summary"
                    data-project-details-target="input"
                    class="block w-full rounded-md border-gray-300 shadow-sm transition-colors duration-200 focus:border-gray-500 focus:ring-gray-500 sm:text-sm"
                    rows="4"
                    placeholder="Describe your project in a few sentences..."
                  >{{ project.summary }}</textarea>
                </div>
                <div class="space-y-2">
                  <label for="key_features" class="block text-sm font-medium text-gray-700">
                    Key Features
                    <span class="ml-1 text-xs text-gray-500">(Main functionalities and benefits)</span>
                  </label>
                  <textarea
                    id="key_features"
                    name="key_features"
                    data-project-details-target="input"
                    class="block w-full rounded-md border-gray-300 shadow-sm transition-colors duration-200 focus:border-gray-500 focus:ring-gray-500 sm:text-sm"
                    rows="4"
                    placeholder="List your project's key features..."
                  >{{ project.key_features }}</textarea>
                </div>
              </div>
              <!-- Target Audience Section -->
              <div class="pt-6 space-y-6 border-t border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900">Audience & Usage</h3>
                <div class="grid gap-6">
                  <div class="space-y-2">
                    <label for="target_audience" class="block text-sm font-medium text-gray-700">
                      Target Audience
                      <span class="ml-1 text-xs text-gray-500">(Who is this for?)</span>
                    </label>
                    <textarea
                      id="target_audience"
                      name="target_audience_summary"
                      data-project-details-target="input"
                      class="block w-full rounded-md border-gray-300 shadow-sm transition-colors duration-200 focus:border-gray-500 focus:ring-gray-500 sm:text-sm"
                      rows="3"
                      placeholder="Describe your target audience..."
                    >{{ project.target_audience_summary }}</textarea>
                  </div>
                  <div class="space-y-2">
                    <label for="pain_points" class="block text-sm font-medium text-gray-700">
                      Pain Points Addressed
                      <span class="ml-1 text-xs text-gray-500">(Problems solved)</span>
                    </label>
                    <textarea
                      id="pain_points"
                      name="pain_points"
                      data-project-details-target="input"
                      class="block w-full rounded-md border-gray-300 shadow-sm transition-colors duration-200 focus:border-gray-500 focus:ring-gray-500 sm:text-sm"
                      rows="4"
                      placeholder="What problems does your project solve?"
                    >{{ project.pain_points }}</textarea>
                  </div>
                  <div class="space-y-2">
                    <label for="product_usage" class="block text-sm font-medium text-gray-700">
                      Product Usage
                      <span class="ml-1 text-xs text-gray-500">(How is it used?)</span>
                    </label>
                    <textarea
                      id="product_usage"
                      name="product_usage"
                      data-project-details-target="input"
                      class="block w-full rounded-md border-gray-300 shadow-sm transition-colors duration-200 focus:border-gray-500 focus:ring-gray-500 sm:text-sm"
                      rows="4"
                      placeholder="Explain how your product is used..."
                    >{{ project.product_usage }}</textarea>
                  </div>
                </div>
              </div>
              <!-- Additional Information Section -->
              <div class="pt-6 space-y-6 border-t border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900">Additional Information</h3>
                <div class="grid gap-6">
                  <div class="space-y-2">
                    <label for="links" class="block text-sm font-medium text-gray-700">
                      Links
                      <span class="ml-1 text-xs text-gray-500">(Related resources)</span>
                    </label>
                    <textarea
                      id="links"
                      name="links"
                      data-project-details-target="input"
                      class="block w-full rounded-md border-gray-300 shadow-sm transition-colors duration-200 focus:border-gray-500 focus:ring-gray-500 sm:text-sm"
                      rows="3"
                      placeholder="Add relevant links..."
                    >{{ project.links }}</textarea>
                  </div>
                  <div class="space-y-2">
                    <label for="blog_theme" class="block text-sm font-medium text-gray-700">
                      Blog Theme
                      <span class="ml-1 text-xs text-gray-500">(Content direction)</span>
                    </label>
                    <textarea
                      id="blog_theme"
                      name="blog_theme"
                      data-project-details-target="input"
                      class="block w-full rounded-md border-gray-300 shadow-sm transition-colors duration-200 focus:border-gray-500 focus:ring-gray-500 sm:text-sm"
                      rows="3"
                      placeholder="Define your blog's theme..."
                    >{{ project.blog_theme }}</textarea>
                  </div>
                  <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                    <div class="space-y-2">
                      <label for="founders" class="block text-sm font-medium text-gray-700">
                        Founders
                        <span class="ml-1 text-xs text-gray-500">(Team members)</span>
                      </label>
                      <textarea
                        id="founders"
                        name="founders"
                        data-project-details-target="input"
                        class="block w-full rounded-md border-gray-300 shadow-sm transition-colors duration-200 focus:border-gray-500 focus:ring-gray-500 sm:text-sm"
                        rows="2"
                        placeholder="List project founders..."
                      >{{ project.founders }}</textarea>
                    </div>
                    <div class="space-y-2">
                      <label for="language" class="block text-sm font-medium text-gray-700">
                        Language
                        <span class="ml-1 text-xs text-gray-500">(Content language)</span>
                      </label>
                      <select
                        id="language"
                        name="language"
                        data-project-details-target="input"
                        class="block w-full rounded-md border-gray-300 shadow-sm transition-colors duration-200 focus:border-gray-500 focus:ring-gray-500 sm:text-sm"
                      >
                        {% for value, label in languages %}
                          <option value="{{ value }}" {% if project.language == value %}selected{% endif %}>{{ label }}</option>
                        {% endfor %}
                      </select>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Form Footer with Save Button -->
        <div class="pt-6 border-t border-gray-200">
          <div class="flex justify-end">
            <button
              type="submit"
              class="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-gray-800 rounded-md shadow-sm transition-colors duration-200 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2"
            >
              <svg class="mr-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
              </svg>
              Save Changes
            </button>
          </div>
        </div>
      </form>
        </div>
      </div>
    </div>

    <!-- Blogging Agent Settings Section -->
    <div id="blogging-agent-settings" class="mt-8">
      <div class="bg-white rounded-md border border-gray-200 shadow-sm">
        <div data-controller="archived-list" class="archived-list" data-archived-list-name-value="blogging-agent">
          <button
            class="flex justify-between items-center px-6 py-4 w-full text-left rounded-t-md transition-colors hover:bg-gray-100 focus:outline-none"
            data-action="click->archived-list#toggle"
          >
            <div>
              <h2 class="text-xl font-bold tracking-tight text-gray-900">Blogging Agent</h2>
              <p class="mt-1 text-sm text-gray-600">Configure automatic blog post submission settings</p>
            </div>
            <svg class="w-5 h-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
          <div data-archived-list-target="list" class="p-6 border-t border-gray-200">

        <h3 class="mb-4 text-lg font-semibold text-gray-900">Automatic Submission Configuration</h3>

        <!-- Automatic Post Submission Toggle -->
        <div
          data-controller="auto-submission-toggle"
          data-auto-submission-toggle-project-id-value="{{ project.id }}"
          data-auto-submission-toggle-enabled-value="{{ project.enable_automatic_post_submission|lower }}"
        >
          <div class="flex justify-between items-center">
            <p class="text-sm font-medium text-gray-700">
              Enable Automatic Submission
            </p>
            <button
            type="button"
            data-action="auto-submission-toggle#toggle"
            data-auto-submission-toggle-target="toggle"
            class="group relative inline-flex w-11 shrink-0 rounded-full bg-gray-200 p-0.5 outline-offset-2 outline-gray-600 ring-1 ring-inset ring-gray-900/5 transition-colors duration-200 ease-in-out has-[:checked]:bg-gray-600 has-[:focus-visible]:outline has-[:focus-visible]:outline-2"
            role="switch"
            aria-checked="{{ project.enable_automatic_post_submission|lower }}"
            >
            <span
                data-auto-submission-toggle-target="switch"
                class="size-5 rounded-full bg-white shadow-sm ring-1 ring-gray-900/5 transition-transform duration-200 ease-in-out group-has-[:checked]:translate-x-5"
              ></span>
            </button>
          </div>
        </div>

        <!-- Automatic Submission Form -->
        <form method="post" class="mt-6 space-y-6">
          {% csrf_token %}
          {{ auto_submission_settings_form.non_field_errors | safe }}

          <!-- Datalist for dynamic value suggestions -->
          <datalist id="body-value-suggestions">
            <option value="{% templatetag openvariable %} post_title {% templatetag closevariable %}"></option>
            <option value="{% templatetag openvariable %} description {% templatetag closevariable %}"></option>
            <option value="{% templatetag openvariable %} slug {% templatetag closevariable %}"></option>
            <option value="{% templatetag openvariable %} tags {% templatetag closevariable %}"></option>
            <option value="{% templatetag openvariable %} content {% templatetag closevariable %}"></option>
            <option value="{% templatetag openvariable %} created_at {% templatetag closevariable %}"></option>
          </datalist>

          <div class="space-y-4">
              {% for field in auto_submission_settings_form.visible_fields %}
                {% if field.name == "body" %}
                  <div
                    data-controller="auto-submit-body"
                    data-auto-submit-body-initial-value="{{ field.value|default:'{}' }}"
                  >
                    <label class="block mb-1 text-sm font-medium text-gray-700">Request Body</label>
                    <p class="mb-1 text-xs text-gray-500">Add key-value pairs for the request body. <span class="font-semibold">Values entered without <code>{% templatetag openvariable %} {% templatetag closevariable %}</code> will be used as-is.</span> To use dynamic values (like <code>title</code> or <code>content</code>), wrap them in <code>{% templatetag openvariable %} {% templatetag closevariable %}</code>—these will be replaced dynamically. When entering a value, available dynamic options will appear in a dropdown list for your convenience.</p>
                    <div data-auto-submit-body-target="rows" class="space-y-2"></div>
                    <button type="button" data-action="auto-submit-body#addRow" class="px-3 py-1.5 mt-2 text-xs font-semibold text-gray-700 bg-gray-50 rounded-md border border-gray-200 hover:bg-gray-100">Add Field</button>
                    <input type="hidden" name="body" data-auto-submit-body-target="jsonInput">
                  </div>
                {% elif field.name == "header" %}
                  <div
                    data-controller="auto-submit-header"
                    data-auto-submit-header-initial-value="{{ field.value|default:'{}' }}"
                  >
                    <label class="block mb-1 text-sm font-medium text-gray-700">Request Header</label>
                    <p class="mb-1 text-xs text-gray-500">Add key-value pairs for the request header. Values can be selected from suggestions or entered manually.</p>
                    <div data-auto-submit-header-target="rows" class="space-y-2"></div>
                    <button type="button" data-action="auto-submit-header#addRow" class="px-3 py-1.5 mt-2 text-xs font-semibold text-gray-700 bg-gray-50 rounded-md border border-gray-200 hover:bg-gray-100">Add Field</button>
                    <input type="hidden" name="header" data-auto-submit-header-target="jsonInput">
                  </div>
                {% elif field.name == "posts_per_month" %}
                  <div>
                    {{ field.errors | safe }}
                    <label for="{{ field.id_for_label }}" class="block mb-1 text-sm font-medium text-gray-700">{{ field.label }}</label>
                    {% if field.help_text %}
                      <p class="mb-1 text-xs text-gray-500">{{ field.help_text }}</p>
                    {% endif %}
                    {% render_field field class="block relative px-3 py-2 w-full placeholder-gray-500 text-gray-900 rounded-md border border-gray-300 appearance-none focus:outline-none focus:ring-gray-500 focus:border-gray-500 focus:z-10 sm:text-sm" %}
                  </div>
                <!-- {% elif field.name == "preferred_timezone" %}
                  <div class="flex gap-4">
                    <div class="flex-1">
                      {{ field.errors | safe }}
                      <label for="{{ field.id_for_label }}" class="block mb-1 text-sm font-medium text-gray-700">{{ field.label }}</label>
                      {% render_field field class="block relative px-3 py-2 w-full placeholder-gray-500 text-gray-900 rounded-md border border-gray-300 appearance-none focus:outline-none focus:ring-gray-500 focus:border-gray-500 focus:z-10 sm:text-sm" %}
                      {% if field.help_text %}
                        <p class="mt-1 text-xs text-gray-500">{{ field.help_text }}</p>
                      {% endif %}
                    </div>
                {% elif field.name == "preferred_time" %}
                    <div class="flex-1">
                      {{ field.errors | safe }}
                      <label for="{{ field.id_for_label }}" class="block mb-1 text-sm font-medium text-gray-700">{{ field.label }}</label>
                      {% render_field field type="time" class="block relative px-3 py-2 w-full placeholder-gray-500 text-gray-900 rounded-md border border-gray-300 appearance-none focus:outline-none focus:ring-gray-500 focus:border-gray-500 focus:z-10 sm:text-sm" %}
                      {% if field.help_text %}
                        <p class="mt-1 text-xs text-gray-500">{{ field.help_text }}</p>
                      {% endif %}
                    </div>
                  </div> -->
                {% else %}
                  <div>
                    {{ field.errors | safe }}
                    <label for="{{ field.id_for_label }}" class="block mb-1 text-sm font-medium text-gray-700">{{ field.label }}</label>
                    {% if field.help_text %}
                      <p class="mb-1 text-xs text-gray-500">{{ field.help_text }}</p>
                    {% endif %}
                    {% render_field field class="block relative px-3 py-2 w-full placeholder-gray-500 text-gray-900 rounded-md border border-gray-300 appearance-none focus:outline-none focus:ring-gray-500 focus:border-gray-500 focus:z-10 sm:text-sm" %}
                  </div>
                {% endif %}
              {% endfor %}
          </div>

          <!-- Form Submit Section -->
          <div class="pt-6 border-t border-gray-200">
            <div class="flex justify-end space-x-2">
              <!-- Publish History Link -->
              <a
                href="{% url 'publish_history' project.id %}"
                class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white rounded-md border border-gray-300 transition-colors hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500"
              >
                <svg class="mr-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                View Publish History
              </a>

              <button type="submit" class="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-gray-800 rounded-md shadow-sm transition-colors duration-200 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2">
                <svg class="mr-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                Save Automatic Submission
              </button>
            </div>
          </div>
        </form>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
{% endblock content %}
