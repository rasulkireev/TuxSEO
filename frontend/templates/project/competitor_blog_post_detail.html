{% extends "base_project.html" %}
{% load static %}
{% load markdown_extras %}

{% block meta %}
  <title>TuxSEO - {{ blog_post_title }}</title>
  <meta name="description" content="{{ blog_post_title }}" />
{% endblock meta %}

{% block project_content %}
<div class="mx-auto max-w-4xl">
  <!-- Header -->
  <div class="mb-8">
    <div class="flex gap-4 justify-between items-start mb-4">
      <div class="flex-1">
        <h1 class="text-3xl font-bold text-gray-900">{{ blog_post_title }}</h1>
        <p class="mt-2 text-sm text-gray-600">
          Comparison blog post for {{ competitor.name }}
        </p>
      </div>
      <a
        href="{% url 'project_competitors' project.id %}"
        class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white rounded-md border border-gray-300 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500"
      >
        <svg class="mr-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        Back to Competitors
      </a>
    </div>

    <div class="flex gap-3 items-center text-sm text-gray-500">
      <div class="flex items-center">
        <svg class="mr-1.5 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        Created {{ competitor.created_at|date:"M d, Y" }}
      </div>
      {% if competitor.updated_at != competitor.created_at %}
        <div class="flex items-center">
          <svg class="mr-1.5 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
          </svg>
          Updated {{ competitor.updated_at|date:"M d, Y" }}
        </div>
      {% endif %}
    </div>
  </div>

  <!-- Blog Post Content -->
  {% if competitor.blog_post %}
    <!-- Copy Actions -->
    <div class="flex gap-3 justify-end mb-4">
      <div data-controller="copy-markdown" data-copy-markdown-content-value="{{ competitor.blog_post }}">
        <button
          data-copy-markdown-target="button"
          data-action="click->copy-markdown#copy"
          class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white rounded-md border border-gray-300 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-gray-500"
        >
          <svg class="mr-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
          </svg>
          Copy as Markdown
        </button>
      </div>

      <div data-controller="copy-html">
        <button
          data-action="copy-html#copyAsHtml"
          data-copy-html-target="button"
          class="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-gray-900 rounded-md border border-gray-900 hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-500"
        >
          <svg class="mr-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
          </svg>
          Copy as HTML
        </button>
        <textarea
          data-copy-html-target="source"
          class="sr-only"
          readonly
        >{{ competitor.blog_post }}</textarea>
      </div>
    </div>

    <div class="overflow-hidden bg-white rounded-lg border border-gray-200 shadow-sm">
      <div class="p-8">
        <div class="max-w-none prose prose-lg">
          {{ competitor.blog_post|markdown }}
        </div>
      </div>
    </div>
  {% else %}
    <div class="p-8 text-center bg-white rounded-lg border border-gray-200 shadow-sm">
      <svg class="mx-auto w-12 h-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
      </svg>
      <h3 class="mt-2 text-sm font-medium text-gray-900">No blog post yet</h3>
      <p class="mt-1 text-sm text-gray-500">
        The blog post for this competitor hasn't been generated yet.
      </p>
      <div class="mt-6">
        <a
          href="{% url 'project_competitors' project.id %}"
          class="inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-gray-900 rounded-md border border-transparent hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-gray-500"
        >
          Go to Competitors
        </a>
      </div>
    </div>
  {% endif %}
</div>
{% endblock project_content %}
